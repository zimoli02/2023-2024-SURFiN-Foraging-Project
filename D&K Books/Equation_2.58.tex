\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{amsmath}
\usepackage{accents}

\title{LDS Book Proofs: Equation 2.58}
\author{Zimo Li}
\date{17 October 2023}

\begin{document}
\maketitle

\par\noindent
The likelihood of observation series \(Y_n\) is:
\begin{align*}
    p(Y_n) &= p(y_1, y_2, \hdots, y_n)\\ 
    &= \prod_{1}^{n}p(y_t|Y_{t-1})\\
    \log(p(Y_n)) &= \log(\prod_{1}^{n}p(y_t|Y_{t-1}))\\
    &= \sum_{1}^{n}\log(p(y_t|Y_{t-1}))\\
    &= \sum_{1}^{n}\log(N(a_t, F_t))\\
    &= -\frac{n}{2}\log(2\pi)-\frac{1}{2}\sum_{1}^{n}(\log{F_t}+\frac{v_t^2}{F_t})
\end{align*}

\par\noindent
Assume:
\begin{align*}
    L &= \log(p(Y_n))\\
    &= -\frac{n}{2}\log(2\pi)-\frac{1}{2}\sum_{1}^{n}(\log{F_t}+\frac{v_t^2}{F_t})\\
    e &= \sigma^2_e\\
    \eta &= \sigma^2_\eta
\end{align*}

\par\noindent
Represent \(L\) with \(a_1\), \(P_1\), \(e\), and \(\eta\):
\par\noindent
\begin{minipage}[t]{0.4\textwidth}
    \begin{align*}
        F_t &= P_t + \sigma^2_e\\
        P_t &= \frac{P_{t-1}\sigma^2_e}{P_{t-1} + \sigma^2_e} + \sigma^2_\eta\\
        F_t &= \frac{P_{t-1}\sigma^2_e}{P_{t-1} + \sigma^2_e} + \sigma^2_e + \sigma^2_\eta\\
        &= \frac{(F_{t-1}-\sigma^2_e)\sigma^2_e}{F_{t-1}} + \sigma^2_e + \sigma^2_\eta\\
        &= -\frac{e^2}{F_{t-1}} +2e+\eta
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}[t]{0.4\textwidth}
    \begin{align*}
        v_t &= y_t-a_t\\
        &= y_t - a_{t-1} - (1-\frac{e}{F_{t-1}})v_{t-1}\\
        &= y_t - a_1 - \sum_{i=1}^{t}(1-\frac{e}{F_{i-1}})v_{i-1}
    \end{align*}
\end{minipage}\\

\par\noindent
Now we want to find the corresponding \(e\), \(\eta\),\(a_1\), and \(P_1\) to maximize \(L_t\).
\par\noindent
Regarding \(\sigma^2_e\), which is written as \(e\) here:
\begin{align*}
    \frac{dL}{de} &= -\frac{1}{2}\sum_{t=1}^{n}(\frac{d\log(F_t)}{de} + \frac{d\frac{v_t^2}{F_t}}{de})\\
    &= -\frac{1}{2}\sum_{t=1}^{n}(\frac{1}{F_t}\frac{dF_t}{de} + \frac{2v_t\frac{dv_t}{de}F_t - v_t^2\frac{dF_t}{de}}{F_t^2})\\
    &= -\frac{1}{2}\sum_{t=1}^{n}(\frac{1}{F_t^2}((F_t - v_t^2)\frac{dF_t}{de} + 2F_tv_t\frac{dv_t}{de}))
\end{align*}

\par\noindent
\(\frac{dF_t}{de}\) and \(\frac{dv_t}{de}\) could be derived using recursion:

\par\noindent
\begin{minipage}[t]{0.4\textwidth}
    \begin{align*}
        \frac{dF_1}{de} &= \frac{d(P_1+e)}{de} = 1\\
        \frac{dF_t}{de} &= \frac{d}{de}(-\frac{e^2}{F_{t-1}} +2e+\eta)\\
        &= -\frac{(2F_{t-1}e-e^2\frac{dF_{t-1}}{de})}{F_{t-1}^2}+2\\
        &= \frac{e^2}{F_{t-1}^2}\frac{dF_{t-1}}{de}-\frac{2e}{F_{t-1}}+2
    \end{align*}
\end{minipage}
\hfill
\begin{minipage}[t]{0.4\textwidth}
    \begin{align*}
        \frac{dv_1}{de} &= \frac{d(y_1-a_1)}{de} = 0\\
        \frac{dv_t}{de} &= \frac{d}{de}(y_t - a_1 - \sum_{i=1}^{t}(1-\frac{e}{F_{i-1}})v_{i-1})\\
        &= - \sum_{i=1}^{t}(\frac{dv_{i-1}}{de}-\frac{(v_{i-1}+e\frac{dv_{i-1}}{de})F_{i-1}-ev_{i-1}\frac{dF{i-1}}{de}}{F^2_{i-1}})\\
        &= - \sum_{i=1}^{t}((1-\frac{e}{F^2_{i-1}})\frac{dv_{i-1}}{de}+\frac{ev_{i-1}}{F^2_{i-1}}\frac{dF_{i-1}}{de}-\frac{v_{i-1}}{F_{i-1}})
    \end{align*}
\end{minipage}\\

\end{document}
